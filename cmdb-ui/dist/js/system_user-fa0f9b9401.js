function check_system_user_exist(){$("#system_add_username_input").blur(function(){var s=$("#system_add_username_input"),t=get_hosts_ip(),e=$("#sync_result_show_list");e.empty();var a=get_system_user_list();if(""!=a)for(var r="",_=0;_<select_server_list.length;_++){var n=select_server_list[_],u=a[t[_]];if(4==u.status)r='<button type="button" class="list-group-item-danger">'+n+"获取失败，原因："+u.msg+"</button>";else if(0==u.msg.length)r='<button type="button" class="list-group-item-success">'+n+"不存在该用户</button>";else{for(var i=!1,o=0;o<u.msg.length;o++)u.msg[o]==s.val()&&(i=!0);r=i?'<button type="button" class="list-group-item-danger">'+n+"存在该用户</button>":'<button type="button" class="list-group-item-success">'+n+"不存在该用户</button>"}e.append(r)}}),$("#system_del_username_input").blur(function(){var s=$("#system_del_username_input"),t=get_hosts_ip(),e=$("#sync_result_show_list");e.empty();var a=get_system_user_list();if(""!=a)for(var r="",_=0;_<select_server_list.length;_++){var n=select_server_list[_],u=a[t[_]];if(0==u.msg.length)r='<button type="button" class="list-group-item-danger">'+n+"不存在该用户</button>";else{for(var i=!1,o=0;o<u.msg.length;o++)u.msg[o]==s.val()&&(i=!0);r=i?'<button type="button" class="list-group-item-success">'+n+"存在该用户</button>":'<button type="button" class="list-group-item-danger">'+n+"不存在该用户</button>"}e.append(r)}}),$("#system_update_username_input").blur(function(){var s=$("#system_update_username_input"),t=get_hosts_ip(),e=$("#sync_result_show_list");e.empty();var a=get_system_user_list();if(""!=a)for(var r="",_=0;_<select_server_list.length;_++){var n=select_server_list[_],u=a[t[_]];if(0==u.msg.length)r='<button type="button" class="list-group-item-danger">'+n+"不存在该用户</button>";else{for(var i=!1,o=0;o<u.msg.length;o++)u.msg[o]==s.val()&&(i=!0);r=i?'<button type="button" class="list-group-item-success">'+n+"存在该用户</button>":'<button type="button" class="list-group-item-danger">'+n+"不存在该用户</button>"}e.append(r)}})}function get_system_user_list(){for(var s=new Array,t=0;t<select_server_list.length;t++)s.push(get_host_ip(select_server_list[t]));var e=JSON.stringify({host:s}),a="";return $.ajax({type:"POST",url:"http://cmdb.wanda.cn/api/sync/v1/system/users",data:e,contentType:"application/json;charset=utf-8",dataType:"json",async:!1,success:function(s){a=s.msg},error:function(s){alert("获取主机用户名列表失败，原因:"+s.msg)}}),a}function check_password_equal(s,t,e){if(""!=s.val()&&""!=t.val())return s.val()!=t.val()?(alert("两次密码不一致"),e.attr("disabled",!0),!1):(e.attr("disabled",!1),!0)}function check_password(){$("#system_add_userpassword_input").blur(function(){check_password_equal($("#system_add_userpassword_input"),$("#system_add_userpassword_check_input"),$("#system_add_user_btn"))}),$("#system_add_userpassword_check_input").blur(function(){check_password_equal($("#system_add_userpassword_input"),$("#system_add_userpassword_check_input"),$("#system_add_user_btn"))}),$("#system_update_userpassword_input").blur(function(){check_password_equal($("#system_update_userpassword_input"),$("#system_update_userpassword_check_input"),$("#system_update_user_btn"))}),$("#system_update_userpassword_check_input").blur(function(){check_password_equal($("#system_update_userpassword_input"),$("#system_update_userpassword_check_input"),$("#system_update_user_btn"))})}function add_system_user(){var s=$("#system_add_username_input").val(),t=$("#system_add_userpassword_input").val(),e=$("#system_add_userpassword_check_input").val(),a=new Array;if(a=get_hosts_ip(),0!=a.length&&""!=s&&0!=t&&""!=e){var r=sha512crypt(t,"$6$rounds=5000$salt"),_=datetime_human(),n=$.cookie("unick"),u=n+"_ansible_add_system_user_"+s+"_user_"+datetime_str(),i=JSON.stringify({host:a,name:s,password:r,module:"user",state:"present"}),o=JSON.stringify({type:"ansible"}),l=JSON.stringify({user_name:n,task_name:u,task_type:"timely",task_flag:o,task_args:i,create_time:_,update_time:_}),p=api_server_url+"/api/async/v1/tasks";$.ajax({type:"POST",url:p,data:l,contentType:"application/json;charset=utf-8",dataType:"json",success:function(s){1==s.status&&alert("任务已添加，请到任务界面查看详细信息"),window.location.reload()},error:function(s){alert(s.msg),window.location.reload()}})}else alert("未选择服务器或者输入信息为空"),window.location.reload()}function del_system_user(){var s=$("#system_del_username_input").val(),t=new Array;if(t=get_hosts_ip(),0!=t.length&&""!=s){var e=datetime_human(),a=$.cookie("unick"),r=a+"_ansible_del_user_"+s+"_user_"+datetime_str(),_=JSON.stringify({host:t,name:s,module:"user",state:"absent"}),n=JSON.stringify({type:"ansible"}),u=JSON.stringify({user_name:a,task_name:r,task_type:"timely",task_flag:n,task_args:_,create_time:e,update_time:e}),i=api_server_url+"/api/async/v1/tasks";$.ajax({type:"POST",url:i,data:u,contentType:"application/json;charset=utf-8",dataType:"json",success:function(s){1==s.status&&alert("任务已添加，请到任务界面查看详细信息"),window.location.reload()},error:function(s,t){alert(s.msg),window.location.reload()}})}else alert("用户名为空或未选择服务器"),window.location.reload()}function update_user_password(){var s=$("#system_update_username_input").val(),t=$("#system_update_userpassword_input").val(),e=$("#system_update_userpassword_check_input").val(),a=new Array;if(a=get_hosts_ip(),0!=a.length&&""!=s&&0!=t&&""!=e){var r=sha512crypt(t,"$6$rounds=5000$salt"),_=datetime_human(),n=$.cookie("unick"),u=n+"_ansible_update_user_"+s+"_password_user_"+datetime_str(),i=JSON.stringify({host:a,name:s,password:r,module:"user",state:"update",update_password:"yes"}),o=JSON.stringify({type:"ansible"}),l=JSON.stringify({user_name:n,task_name:u,task_type:"timely",task_flag:o,task_args:i,create_time:_,update_time:_});api_url="http://cmdb.wanda.cn/api/async/v1/tasks",$.ajax({type:"POST",url:api_url,data:l,contentType:"application/json;charset=utf-8",dataType:"json",success:function(s){1==s.status&&alert("任务已添加，请到任务界面查看详细信息"),window.location.reload()},error:function(s,t){alert(s.msg),window.location.reload()}})}else alert("输入错误或未选择服务器"),window.location.reload()}$(function(){show_server_name($("#system_add_user_server_name_select")),show_server_name($("#system_update_user_server_name_select")),check_system_user_exist(),check_password()});