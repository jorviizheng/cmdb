function get_yum_source(){var t=$("#yum_source_select");$.ajax({type:"GET",url:api_server_url+"/api/sync/v1/yum/source/available",contentType:"application/json;charset=utf-8",dataType:"json",success:function(e,a){if(302==e.status)window.location.href="../pages/login.html";else if(0==e.status){yum_source=e.msg;t.empty();var s=1;t.append("<option selected='selected' value=0>请选择..</option>");for(var n in yum_source)s++,"base_url"!=n&&t.append("<option  value="+s+">"+n+"</option>");set_package_input_list()}},error:function(t){alert(t.msg)}})}function yum_source_task(){var t=$("#yum_source_select option:selected").text(),e=$("#yum_source_action_select option:selected").val(),a=yum_source.base_url+"/"+t,s=$("#sync_result_show_list");s.empty();var n="",o=get_hosts_ip();if(0==o.length)n='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',s.append(n),$("#yum_source_select").val(0);else if(o.length>1){var u=check_servers_os_version_equal();if(u)if(""!=t&&0!=e){var r="";1==e?r="present":2==e&&(r="absent");var i=datetime_human(),l=$.cookie("unick"),c=l+"_ansible_yum_source_"+l+"_yum_repo_"+datetime_str(),p=JSON.stringify({host:o,name:t,state:r,description:"local",enabled:"1",gpgcheck:"0",baseurl:a,module:"yum_repo"}),_=JSON.stringify({type:"ansible",action:r}),g=JSON.stringify({user_name:l,task_name:c,task_type:"timely",task_flag:_,task_args:p,create_time:i,update_time:i});$.ajax({type:"POST",url:api_server_url+"/api/async/v1/tasks",data:g,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){1==t.status&&alert("任务已添加，请到任务界面查看详细信息"),window.location.reload()},error:function(t){alert(t.msg),window.location.reload()}})}else alert("选择项错误"),n='<button type="button" class="list-group-item-danger">选择项错误</button>',s.append(n),package_btn.attr("disabled",!0),$("#yum_source_select").val(0);else n='<button type="button" class="list-group-item-danger">已选择服务器系统版本不一致，无法进行批量处理</button>',s.append(n),$("#yum_source_select").val(0)}}function check_yum_resource_installed(){var t=$("#yum_source_select option:selected").text(),e=$("#source_btn"),a=$("#sync_result_show_list");a.empty();var s="",n=get_hosts_ip();if(0==n.length)s='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',a.append(s),$("#yum_source_select").val(0),e.attr("disabled",!0);else{if(check_servers_os_version_equal()){e.attr("disabled",!1);var o=JSON.stringify({host:n,source_name:t});$.ajax({type:"POST",url:api_server_url+"/api/sync/v1/yum/source/installed",data:o,contentType:"application/json;charset=utf-8",dataType:"json",success:function(e){for(var o=0;o<select_server_list.length;o++){var u=select_server_list[o],r=e.msg[n[o]];r.status>0?s=4==r.status?'<button type="button" class="list-group-item-danger">'+u+" 获取失败，原因"+r.msg+"</button>":'<button type="button" class="list-group-item-danger">'+u+" 未安装源"+t+"</button>":0==r.status&&(s='<button type="button" class="list-group-item-success">'+u+" 已安装源:"+t+"</button>"),a.append(s)}},error:function(t){s='<button type="button" class="list-group-item-danger">后台服务错误，稍后尝试</button>',a.append(s),package_btn.attr("disabled",!0),$("#package_input").val(""),window.location.reload()}})}else s='<button type="button" class="list-group-item-danger">已选择服务器系统版本不一致，无法进行批量处理</button>',a.append(s),e.attr("disabled",!0),$("#yum_source_select").val(0)}}function set_package_version_select(t){var e=$("#yum_package_version_select");e.empty(),e.append("<option selected='selected'  value=0>请选择..</option>"),$.each(yum_source,function(a,s){"base_url"!=a&&$.each(s,function(a,s){if(a==t)for(var n=0;n<s.length;n++)void 0===s[n]?e.append("<option  value="+n+">latest</option>"):e.append("<option  value="+n+">"+s[n]+"</option>")})})}function get_package_source(t){var e="";return $.each(yum_source,function(a,s){"base_url"!=a&&$.each(s,function(s){s==t&&(e=a)})}),e}function set_package_input_list(){var t=$("#package_list");t.empty(),$.each(yum_source,function(e,a){"base_url"!=e&&$.each(a,function(e){t.append("<option>"+e+"</option>")})})}function yum_package_task(){var t=$("#package_input").val().split(".")[0],e=$("#yum_package_version_select option:selected").text(),a=$("#yum_package_action_select option:selected").val(),s="",n=get_hosts_ip(),o=$("#sync_result_show_list");o.empty();var u="";if(0==n.length)u='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',o.append(u),$("#package_input").val("");else if(n.length>1){var r=check_servers_os_version_equal();if(r)if(""!=(s="latest"==e?t:t+"-"+e)&&""!=e&&0!=a){var i="";1==a?i="present":2==a?i="absent":3==a&&(i="last");var l=datetime_human(),c=$.cookie("unick"),p=c+"_ansible_yum_package_"+c+"_yum_"+datetime_str(),_=JSON.stringify({package_name:s,host:n,state:i,module:"yum"}),g=JSON.stringify({type:"ansible",action:i}),d=JSON.stringify({user_name:c,task_name:p,task_type:"timely",task_flag:g,task_args:_,create_time:l,update_time:l});$.ajax({type:"POST",url:api_server_url+"/api/async/v1/tasks",data:d,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t,e){1==t.status&&(alert("任务已添加，请到任务界面查看详细信息"),window.location.reload())},error:function(t,e){alert(t.msg),window.location.reload()}})}else u='<button type="button" class="list-group-item-danger">选择项错误</button>',o.append(u),$("#package_input").val("");else u='<button type="button" class="list-group-item-danger">已选择服务器系统版本不一致，无法进行批量处理</button>',o.append(u),$("#package_input").val("")}}function check_server_package_installed(){var t=$("#package_input").val();set_package_version_select(t);var e=check_servers_os_version_equal(),a=$("#package_btn"),s=$("#sync_result_show_list");s.empty();var n="",o=get_hosts_ip();if(0==o.length)n='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',s.append(n),a.attr("disabled",!0),$("#package_input").val("");else if(e){var u=get_package_source(t);if(""==u)n='<button type="button" class="list-group-item-danger">软件名为空</button>',s.append(n),a.attr("disabled",!0);else{a.attr("disabled",!1);var r=JSON.stringify({host:o,package_name:t});$.ajax({type:"POST",url:api_server_url+"/api/sync/v1/yum/package/installed",data:r,contentType:"application/json;charset=utf-8",dataType:"json",async:!1,success:function(e){for(var a=0;a<select_server_list.length;a++){var u=select_server_list[a],r=e.msg[o[a]];r.status>0?n=4==r.status?'<button type="button" class="list-group-item-danger">'+u+" 获取失败，原因"+r.msg+"</button>":'<button type="button" class="list-group-item-danger">'+u+" 未安装 "+t+"</button>":0==r.status&&(n='<button type="button" class="list-group-item-success">'+u+" 已安装版本:"+r.msg.version+"</button>"),s.append(n)}},error:function(){n='<button type="button" class="list-group-item-danger">后台服务错误，稍后尝试</button>',s.append(n),a.attr("disabled",!0),$("#package_input").val("")}})}}else n='<button type="button" class="list-group-item-danger">已选择服务器系统版本不一致，无法进行批量处理</button>',s.append(n),a.attr("disabled",!0),$("#package_input").val("")}function check_server_has_source(){var t=$("#package_btn"),e=$("#package_input").val(),a=get_package_source(e),s=$("#sync_result_show_list");s.empty();var n="",o=get_hosts_ip();if(0==o.length)n='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',s.append(n);else{if(check_servers_os_version_equal()){t.attr("disabled",!1);var u=JSON.stringify({host:o,source_name:"*"});$.ajax({type:"POST",url:api_server_url+"/api/sync/v1/yum/source/installed/list",data:u,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){if(0==t.status&&0!=t.msg)for(var e=0;e<select_server_list.length;e++){for(var u=select_server_list[e],r=t.msg[o[e]].msg,i=!1,l=0;l<r.length;l++)if(a==r[l]){i=!0;break}n=i?'<button type="button" class="list-group-item-success">'+u+"可安装</button>":'<button type="button" class="list-group-item-danger">'+u+"缺少对应源:"+a+"</button>",s.append(n)}},error:function(e){n='<button type="button" class="list-group-item-danger">后台服务错误，稍后尝试</button>',s.append(n),t.attr("disabled",!0),$("#package_input").val("")}})}else n='<button type="button" class="list-group-item-danger">已选择服务器系统版本不一致，无法进行批量处理</button>',s.append(n),t.attr("disabled",!0)}}var yum_source=new JSON.constructor;