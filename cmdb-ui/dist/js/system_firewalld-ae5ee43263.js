function set_firewall_zone(){var t=$("#firewall_zone_select"),e=$("#firewall_type_select"),a=$("#firewall_btn");t.empty();var l=$("#sync_result_show_list");l.empty();var s="",r=get_hosts_ip();if(r.length>1)s='<button type="button" class="list-group-item-danger">防火墙暂不支持批量选择</button>',l.append(s),e.val(0),a.attr("disabled",!0);else if(0==r.length)s='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',l.append(s),e.val(0),a.attr("disabled",!0);else{a.attr("disabled",!1);var i=JSON.stringify({host:r}),n=api_server_url+"/api/sync/v1/firewalld/zone";$.ajax({type:"POST",url:n,data:i,contentType:"application/json;charset=utf-8",dataType:"json",async:!1,success:function(e){if(0==e.status){for(var a=0;a<e.msg[r[0]].msg.length;a++)index=a+1,t.append("<option  value="+index+">"+e.msg[r[0]].msg[a]+"</option>");$("#firewall_btn").attr("disabled",!1)}else s='<button type="button" class="list-group-item-danger">获取主机firewall zone失败，原因:'+e.msg[r[0]].msg+"</button>",l.append(s),$("#firewall_btn").attr("disabled",!0)},error:function(t){alert(t),$("#firewall_btn").attr("disabled",!0)}})}}function get_firewall_service(){var t=($("#firewall_input"),$("#firewall_btn"),$("#sync_result_show_list"));$("#firewall_type_select");t.empty();var e="",a=get_hosts_ip(),l=JSON.stringify({host:a}),s=api_server_url+"/api/sync/v1/firewalld/service";$.ajax({type:"POST",url:s,data:l,contentType:"application/json;charset=utf-8",dataType:"json",async:!1,success:function(l){var s=l.msg[a[0]];if(0==l.status){var r=$("#firewall_list");r.empty();for(var i=0;i<s.msg.length;i++)r.append("<option>"+s.msg[i]+"</option>");$("#firewall_btn").attr("disabled",!1)}else e='<button type="button" class="list-group-item-danger">获取主机firewall service失败，原因:'+s.msg+"</button>",t.append(e),$("#firewall_btn").attr("disabled",!0)},error:function(l){e='<button type="button" class="list-group-item-danger">获取主机firewall service失败，原因:'+l.msg[a[0]].msg+"</button>",t.append(e),$("#firewall_btn").attr("disabled",!0)}})}function set_input_placeholder(){var t=$("#firewall_type_select option:selected"),e=$("#firewall_input"),a=$("#sync_result_show_list"),l=$("#firewall_type_select"),s=$("#firewall_btn");a.empty();var r="",i=get_hosts_ip();i.length>1?(r='<button type="button" class="list-group-item-danger">防火墙暂不支持批量选择</button>',a.append(r),l.val(0),s.attr("disabled",!0)):0==i.length?(r='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',a.append(r),l.val(0),s.attr("disabled",!0)):(s.attr("disabled",!1),0==t.val()?e.attr("placeholder",""):1==t.val()?(e.attr("placeholder","like http(支持自动提示本服务器上的Firewall service)"),get_firewall_service()):2==t.val()?e.attr("placeholder","like 80/tcp or 80-81/tcp or 80/udp or 80-81/udp"):3==t.val()?e.attr("placeholder","like 192.168.1.0/24"):4==t.val()&&(e.attr("placeholder","直接选择action即可"),e.attr("readonly","readonly")))}function firewall_task(){var t=$("#firewall_type_select option:selected"),e=$("#firewall_zone_select option:selected"),a=$("#firewalld_action_select option:selected"),l=$("#firewall_input").val(),s="no";$("#permanent_checkbox").is(":checked")&&(s="yes");var r=get_hosts_ip(),i=$("#sync_result_show_list");i.empty();var n="";if(0==r.length)n='<button type="button" class="list-group-item-danger">未选择服务器，请选择</button>',i.append(n),$("#firewall_type_select").val(0);else if(r.length>1)n='<button type="button" class="list-group-item-danger">防火墙暂不支持批量选择</button>',i.append(n),$("#firewall_type_select").val(0);else if(0!=t.val()&&0!=e.val()&&0!=a.val())if(""==l&&4!=t.val())alert("规则不能为空");else{var o=datetime_human(),p=$.cookie("unick"),c=p+"_ansible_firewalld_"+datetime_str(),d=new Object;d.host=r,d.module="firewalld",d.state=a.text(),d.permanent=s,1==t.val()?d.service=l:2==t.val()?d.port=l:3==t.val()?d.source=l:4==t.val()&&(d.masquerade=l);var _=JSON.stringify(d),u=JSON.stringify({type:"ansible"}),f=JSON.stringify({user_name:p,task_name:c,task_type:"timely",task_flag:u,task_args:_,create_time:o,update_time:o}),b=api_server_url+"/api/async/v1/tasks";$.ajax({type:"POST",url:b,data:f,contentType:"application/json;charset=utf-8",dataType:"json",success:function(t){1==t.status&&alert("任务已添加，请到任务界面查看详细信息"),window.location.reload()},error:function(t){alert(t.msg),window.location.reload()}})}else alert("选择项错误")}